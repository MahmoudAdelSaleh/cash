<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Tahoma, sans-serif; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #444; padding: 5px; text-align: center; }
    #reader { width: 100%; margin: auto; }
    .controls { margin: 10px 0; }
    button { padding: 5px 10px; margin: 2px; }
  </style>
</head>
<body>
  <h2>ğŸ’³ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2>

  <div id="reader"></div>

  <h3>Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody id="invoice"></tbody>
    <tfoot>
      <tr>
        <td colspan="3">Ø§Ù„ØªÙˆØµÙŠÙ„</td>
        <td>
          <input type="number" id="delivery" value="20" style="width:70px;">
          <button onclick="changeDelivery(1)">+</button>
          <button onclick="changeDelivery(-1)">-</button>
        </td>
      </tr>
      <tr>
        <td colspan="3"><b>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</b></td>
        <td id="total">0</td>
      </tr>
    </tfoot>
  </table>

  <script>
    // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (Ù…Ù…ÙƒÙ† ØªØªØºÙŠØ± Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª)
    const products = {
      "123456789": { name: "Ø¨ÙŠØ¨Ø³ÙŠ", price: 10 },
      "987654321": { name: "Ø´ÙŠØ¨Ø³ÙŠ", price: 5 },
      "111111111": { name: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", price: 15 }
    };

    let invoice = [];
    let delivery = 20;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function renderInvoice() {
      const tbody = document.getElementById("invoice");
      tbody.innerHTML = "";
      let total = 0;

      invoice.forEach(item => {
        const row = document.createElement("tr");
        const subtotal = item.price * item.qty;
        total += subtotal;

        row.innerHTML = `
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td>${item.qty}</td>
          <td>${subtotal}</td>
        `;
        tbody.appendChild(row);
      });

      total += delivery;
      document.getElementById("total").innerText = total;
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function addProduct(code) {
      if (!products[code]) {
        alert("ğŸš« Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
        return;
      }

      let item = invoice.find(p => p.code === code);
      if (item) {
        item.qty++;
      } else {
        invoice.push({ code, name: products[code].name, price: products[code].price, qty: 1 });
      }
      renderInvoice();
    }

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„
    document.getElementById("delivery").addEventListener("input", function() {
      delivery = parseFloat(this.value) || 0;
      renderInvoice();
    });

    function changeDelivery(step) {
      delivery += step;
      document.getElementById("delivery").value = delivery;
      renderInvoice();
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    function onScanSuccess(decodedText) {
      addProduct(decodedText);
    }

    let html5QrcodeScanner = new Html5QrcodeScanner("reader", {
      fps: 10,
      qrbox: 250
    });
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>