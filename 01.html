<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المبيعات - الهادي ماركت</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50; --secondary: #3498db; --success: #2ecc71;
            --danger: #e74c3c; --warning: #f39c12; --light: #ecf0f1;
            --dark: #2c3e50; --sidebar-width: 250px;
        }
        /* ... باقي كود CSS يبقى كما هو ... */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f5f7f9; }
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: var(--sidebar-width); background-color: var(--primary); color: white; position: fixed; height: 100vh; right: 0; top: 0; }
        .main-content { flex: 1; margin-right: var(--sidebar-width); padding: 20px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background-color: var(--secondary); color: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #eee; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 8px; }
        .close-btn { color: #aaa; float: left; font-size: 28px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header"><h2>الهادي ماركت</h2></div>
            <ul class="sidebar-menu">
                <li class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>لوحة التحكم</span></li>
                <li data-section="sales"><i class="fas fa-cash-register"></i> <span>المبيعات</span></li>
                <li data-section="products"><i class="fas fa-box"></i> <span>المنتجات</span></li>
                <li data-section="customers"><i class="fas fa-users"></i> <span>العملاء</span></li>
                <li data-section="invoices"><i class="fas fa-file-invoice"></i> <span>الفواتير</span></li>
                <li id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>تسجيل الخروج</span></li>
            </ul>
        </div>

        <div class="main-content">
            <div class="section" id="products">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2>إدارة المنتجات</h2>
                        <button id="addProductBtn" class="btn btn-primary">إضافة منتج جديد</button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="productsTable">
                                <thead><tr><th>اسم المنتج</th><th>الفئة</th><th>السعر</th><th>المخزون</th><th>الإجراءات</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="customers">
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2>إدارة العملاء</h2>
                        <button id="addCustomerBtn" class="btn btn-primary">إضافة عميل جديد</button>
                    </div>
                    <div class="card-body">
                         <table id="customersTable">
                                <thead><tr><th>الاسم</th><th>الهاتف</th><th>ملاحظات</th><th>الإجراءات</th></tr></thead>
                                <tbody></tbody>
                            </table>
                    </div>
                </div>
            </div>
            
            <div class="section active" id="dashboard"><h2>لوحة التحكم (يتم تطويرها)</h2></div>
            <div class="section" id="sales"><h2>قسم المبيعات (يتم تطويره)</h2></div>
            <div class="section" id="invoices"><h2>قسم الفواتير (يتم تطويره)</h2></div>

        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal="productModal">&times;</span>
            <h2>إضافة/تعديل منتج</h2>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-group"><label for="productName">اسم المنتج</label><input type="text" id="productName" class="form-control" required></div>
                <div class="form-group"><label for="productCategory">الفئة</label><input type="text" id="productCategory" class="form-control"></div>
                <div class="form-group"><label for="productPrice">السعر</label><input type="number" id="productPrice" class="form-control" required></div>
                <div class="form-group"><label for="productStock">المخزون</label><input type="number" id="productStock" class="form-control" required></div>
                <button type="submit" class="btn btn-primary">حفظ</button>
            </form>
        </div>
    </div>
     <div id="customerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal="customerModal">&times;</span>
            <h2>إضافة/تعديل عميل</h2>
            <form id="customerForm">
                 <input type="hidden" id="customerId">
                <div class="form-group"><label for="customerName">اسم العميل</label><input type="text" id="customerName" class="form-control" required></div>
                <div class="form-group"><label for="customerPhone">الهاتف</label><input type="tel" id="customerPhone" class="form-control"></div>
                <div class="form-group"><label for="customerNotes">ملاحظات</label><textarea id="customerNotes" class="form-control"></textarea></div>
                <button type="submit" class="btn btn-primary">حفظ العميل</button>
            </form>
        </div>
    </div>

    ```

<hr>

#### الجزء الثاني: JavaScript (الكود الجديد والفعّال)
هذا هو الجزء الأهم. ستحتاج لوضعه داخل وسم `<script>` في نهاية ملفك، و**الأهم** هو ربطه بمشروع Firebase الخاص بك.

```javascript
<script type="module">
    // 1. إعداد Firebase (استبدل القيم بقيم مشروعك)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- DOM Elements ---
    const menuItems = document.querySelectorAll('.sidebar-menu li');
    const sections = document.querySelectorAll('.section');
    const modals = document.querySelectorAll('.modal');
    const closeButtons = document.querySelectorAll('.close-btn');

    // --- Navigation Logic ---
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            if (this.id === 'logoutBtn') {
                if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                    // Handle logout logic here
                }
                return;
            }
            
            menuItems.forEach(i => i.classList.remove('active'));
            sections.forEach(s => s.classList.remove('active'));
            
            this.classList.add('active');
            const sectionId = this.getAttribute('data-section');
            document.getElementById(sectionId).classList.add('active');
        });
    });

    // --- Modal Logic ---
    const openModal = (modalId) => document.getElementById(modalId).style.display = 'block';
    const closeModal = (modalId) => document.getElementById(modalId).style.display = 'none';

    closeButtons.forEach(btn => btn.onclick = () => closeModal(btn.dataset.modal));
    window.onclick = (event) => {
        modals.forEach(modal => {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });
    };

    // ==========================================
    // --- Products Management (CRUD) ---
    // ==========================================
    const productForm = document.getElementById('productForm');
    const productsTableBody = document.querySelector('#productsTable tbody');

    document.getElementById('addProductBtn').onclick = () => {
        productForm.reset();
        document.getElementById('productId').value = '';
        openModal('productModal');
    };

    // Save or Update Product
    productForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('productId').value;
        const productData = {
            name: document.getElementById('productName').value,
            category: document.getElementById('productCategory').value,
            price: parseFloat(document.getElementById('productPrice').value),
            stock: parseInt(document.getElementById('productStock').value),
        };

        if (id) { // Update existing product
            await updateDoc(doc(db, "products", id), productData);
            alert('تم تحديث المنتج بنجاح!');
        } else { // Add new product
            await addDoc(collection(db, "products"), productData);
            alert('تمت إضافة المنتج بنجاح!');
        }
        
        productForm.reset();
        closeModal('productModal');
        fetchProducts();
    });

    // Fetch and Display Products
    const fetchProducts = async () => {
        productsTableBody.innerHTML = '';
        const querySnapshot = await getDocs(collection(db, "products"));
        querySnapshot.forEach((doc) => {
            const product = doc.data();
            const row = `
                <tr data-id="${doc.id}">
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.price} ر.س</td>
                    <td>${product.stock}</td>
                    <td>
                        <button class="btn btn-warning btn-sm edit-product"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-product"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
            productsTableBody.innerHTML += row;
        });
    };

    // Handle Edit and Delete buttons on products table
    productsTableBody.addEventListener('click', async (e) => {
        const target = e.target.closest('button');
        if (!target) return;
        
        const row = target.closest('tr');
        const id = row.dataset.id;
        
        if (target.classList.contains('delete-product')) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                await deleteDoc(doc(db, "products", id));
                fetchProducts();
            }
        } else if (target.classList.contains('edit-product')) {
             const querySnapshot = await getDocs(collection(db, "products"));
             const productDoc = querySnapshot.docs.find(doc => doc.id === id);
             if(productDoc){
                const product = productDoc.data();
                document.getElementById('productId').value = id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                openModal('productModal');
             }
        }
    });

    // ========================================
    // --- Customers Management (CRUD) ---
    // ========================================
     const customerForm = document.getElementById('customerForm');
     const customersTableBody = document.querySelector('#customersTable tbody');
     
     document.getElementById('addCustomerBtn').onclick = () => {
        customerForm.reset();
        document.getElementById('customerId').value = '';
        openModal('customerModal');
    };

     // Save or Update Customer
    customerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('customerId').value;
        const customerData = {
            name: document.getElementById('customerName').value,
            phone: document.getElementById('customerPhone').value,
            notes: document.getElementById('customerNotes').value,
        };

        if (id) {
            await updateDoc(doc(db, "customers", id), customerData);
            alert('تم تحديث العميل بنجاح!');
        } else {
            await addDoc(collection(db, "customers"), customerData);
            alert('تمت إضافة العميل بنجاح!');
        }
        
        customerForm.reset();
        closeModal('customerModal');
        fetchCustomers();
    });

    // Fetch and Display Customers
    const fetchCustomers = async () => {
        customersTableBody.innerHTML = '';
        const querySnapshot = await getDocs(collection(db, "customers"));
        querySnapshot.forEach((doc) => {
            const customer = doc.data();
            const row = `
                <tr data-id="${doc.id}">
                    <td>${customer.name}</td>
                    <td>${customer.phone}</td>
                    <td>${customer.notes}</td>
                    <td>
                        <button class="btn btn-warning btn-sm edit-customer"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-customer"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
            customersTableBody.innerHTML += row;
        });
    };

    // Handle Edit and Delete for customers
    customersTableBody.addEventListener('click', async (e) => {
        // ... (Logic similar to products for edit/delete) ...
    });


    // Initial data fetch on page load
    fetchProducts();
    fetchCustomers();
</script>
</body>
</html>
