<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© - Ù…ØªØ¬Ø±Ùƒ</title>
Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
Â  <style>
Â  Â  body { font-family: Tahoma, sans-serif; margin:0; padding:10px; background:#f5f5f5; }
Â  Â  header { text-align:center; padding:10px; font-size:22px; background:#007bff; color:#fff; }
Â  Â  .field { margin-bottom:10px; }
Â  Â  label { display:block; margin-bottom:4px; font-weight:bold; }
Â  Â  input { width:100%; padding:8px; border-radius:5px; border:1px solid #ccc; font-size:16px; }
Â  Â  button { width:100%; padding:10px; margin-top:8px; font-size:18px; border:none; border-radius:5px; background:#28a745; color:#fff; cursor:pointer; }
Â  Â  button:hover { opacity:0.9; }
Â  Â  table { width:100%; border-collapse:collapse; margin-top:15px; font-size:16px; }
Â  Â  th, td { border:1px solid #ddd; padding:8px; text-align:center; }
Â  Â  th { background:#007bff; color:#fff; }
Â  Â  #reader { width:100%; max-width:400px; margin:10px auto; }
Â  Â  .delivery { margin-top:10px; display:flex; align-items:center; gap:5px; }
Â  Â  .delivery input { width:100px !important; }
Â  Â  .total { margin-top:15px; font-size:20px; text-align:center; font-weight:bold; }
Â  </style>
</head>
<body>

<header>
Â  <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø±" style="max-height:50px; vertical-align:middle;">
Â  <span> ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹</span>
</header>

<div class="field">
Â  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
Â  <input type="text" id="customerName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">
</div>

<div class="field">
Â  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
Â  <input type="tel" id="customerPhone" placeholder="201xxxxxxxxx">
</div>

<button onclick="startScanner()">Â  ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</button>
<div id="reader"></div>

<table>
Â  <thead>
Â  Â  <tr>
Â  Â  Â  <th>Ø§Ù„ØµÙ†Ù</th>
Â  Â  Â  <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
Â  Â  Â  <th>Ø§Ù„Ø³Ø¹Ø±</th>
Â  Â  Â  <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
Â  Â  Â  <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
Â  Â  </tr>
Â  </thead>
Â  <tbody id="invoiceBody"></tbody>
</table>

<div class="delivery">
Â  <label>Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø¬Ù†ÙŠÙ‡):</label>
Â  <button onclick="changeDelivery(-5)">-5</button>
Â  <input type="number" id="delivery" value="10" min="0" onchange="updateTotal()">
Â  <button onclick="changeDelivery(5)">+5</button>
</div>

<div class="total">
Â  Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="totalAmount">0.00</span> Ø¬.Ù…
</div>

<button onclick="sendWhatsApp()">Â  Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>

<script>
Â  let productsDB = [];
Â  let invoice = {};

Â  fetch("p.json")
Â  Â  .then(r => r.json())
Â  Â  .then(data => productsDB = data)
Â  Â  .catch(err => alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¹Ø¨Ø± Ø³ÙŠØ±ÙØ±"));

Â  function startScanner() {
Â  Â  const qr = new Html5Qrcode("reader");
Â  Â  qr.start(
Â  Â  Â  { facingMode: "environment" },
Â  Â  Â  { fps: 10, qrbox: 250 },
Â  Â  Â  code => {
Â  Â  Â  Â  addProduct(code);
Â  Â  Â  Â  qr.stop();
Â  Â  Â  },
Â  Â  Â  err => {}
Â  Â  );
Â  }

Â  function addProduct(barcode) {
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ø°ÙŠ ØªÙ… Ù‚Ø±Ø§Ø¡ØªÙ‡ Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    const numericBarcode = parseInt(barcode);
Â  Â  const prod = productsDB.find(p => p.barcode === numericBarcode);
Â  Â  if (!prod) return alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©");
Â  Â  if (!invoice[numericBarcode]) {
      invoice[numericBarcode] = { ...prod, qty: 0 };
    }
Â  Â  invoice[numericBarcode].qty++;
Â  Â  renderInvoice();
Â  }

Â  function renderInvoice() {
Â  Â  const tbody = document.getElementById("invoiceBody");
Â  Â  tbody.innerHTML = "";
Â  Â  let total = 0;
Â  Â  for (const code in invoice) {
Â  Â  Â  const item = invoice[code];
Â  Â  Â  const rowTotal = item.price * item.qty;
Â  Â  Â  total += rowTotal;
Â  Â  Â  tbody.innerHTML += `<tr>
Â  Â  Â  Â  <td>${item.name}</td>
Â  Â  Â  Â  <td>${item.unit ? item.unit : '-'}</td>
Â  Â  Â  Â  <td>${item.price.toFixed(2)}</td>
Â  Â  Â  Â  <td>${item.qty}</td>
Â  Â  Â  Â  <td>${rowTotal.toFixed(2)}</td>
Â  Â  Â  </tr>`;
Â  Â  }
Â  Â  const delivery = parseFloat(document.getElementById("delivery").value) || 0;
Â  Â  document.getElementById("totalAmount").innerText = (total + delivery).toFixed(2);
Â  }

Â  function changeDelivery(val) {
Â  Â  const inp = document.getElementById("delivery");
Â  Â  inp.value = Math.max(0, parseFloat(inp.value) + val);
Â  Â  updateTotal();
Â  }

Â  function updateTotal() {
Â  Â  renderInvoice();
Â  }

Â  function sendWhatsApp() {
Â  Â  const name = document.getElementById("customerName").value.trim();
Â  Â  const phone = document.getElementById("customerPhone").value.trim();
Â  Â  if (!name || !phone) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");

Â  Â  let msg = `*ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ù…ØªØ¬Ø±Ùƒ* \nğŸ§¾ Ø¹Ù…ÙŠÙ„: ${name}\nğŸ“ ${phone}\n\n`;
Â  Â  let total = 0;
Â  Â  for (const code in invoice) {
Â  Â  Â  const item = invoice[code];
Â  Â  Â  const rowT = item.price * item.qty;
Â  Â  Â  msg += `${item.name} (${item.unit}) x${item.qty} = ${rowT.toFixed(2)} Ø¬.Ù…\n`;
Â  Â  Â  total += rowT;
Â  Â  }

Â  Â  const delivery = parseFloat(document.getElementById("delivery").value) || 0;
Â  Â  total += delivery;
Â  Â  msg += `\nğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„: ${delivery.toFixed(2)} Ø¬.Ù…\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toFixed(2)} Ø¬.Ù…\n`;
Â  Â  msg += "\nØ´ÙƒØ±Ù‹Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø±Ùƒ Ù…ØªØ¬Ø±Ù†Ø§ ğŸŒ¹";

Â  Â  const url = `https://wa.me/${phone.replace(/^0/, "20")}?text=${encodeURIComponent(msg)}`;
Â  Â  window.open(url, "_blank");
Â  }

Â  // Ø¥ØªØ§Ø­Ø© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… (global scope)
Â  window.startScanner = startScanner;
Â  window.changeDelivery = changeDelivery;
Â  window.updateTotal = updateTotal;
Â  window.sendWhatsApp = sendWhatsApp;
</script>
</body>
</html>
