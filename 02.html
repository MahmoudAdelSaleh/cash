<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d4af37">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      direction: rtl;
      background: #f9f9f9;
    }
    header {
      background: #d4af37;
      color: white;
      padding: 10px;
      text-align: center;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: #333;
      color: white;
      padding: 10px;
    }
    nav button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    nav button:hover {
      text-decoration: underline;
    }
    section {
      display: none;
      padding: 20px;
    }
    section.active {
      display: block;
    }
    #connectionStatus {
      position: fixed;
      top: 0;
      left: 0;
      padding: 5px 10px;
      font-size: 14px;
      color: #fff;
      background-color: green;
      z-index: 1000;
    }
    .offline {
      background-color: red !important;
    }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
  <header>
    <h1>Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h1>
  </header>

  <div id="connectionStatus">Ù…ØªØµÙ„</div>

  <nav>
    <button onclick="App.showSection('invoices')">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
    <button onclick="App.showSection('workers')">Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</button>
    <button onclick="App.showSection('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
    <button onclick="App.showSection('scanner')">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
  </nav>

  <section id="invoices" class="active">
    <h2>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
    <div id="invoiceList"></div>
    <button onclick="InvoicesController.newInvoice()">ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </section>

  <section id="workers">
    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
    <div id="workerList"></div>
    <button onclick="WorkersController.newWorker()">Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
  </section>

  <section id="reports">
    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
    <button onclick="ReportsController.backup()">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
    <button onclick="ReportsController.restore()">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
    <button onclick="ReportsController.reset()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
  </section>

  <section id="scanner">
    <h2>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2>
    <input type="text" id="barcodeInput" placeholder="Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù‡Ù†Ø§">
  </section>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_DOMAIN",
      projectId: "YOUR_PROJECT_ID"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    // ================== Invoices Controller ==================
    const InvoicesController = {
      list: [],
      async load() {
        const snapshot = await db.collection("invoices").get();
        this.list = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        this.render();
      },
      render() {
        const container = document.getElementById("invoiceList");
        container.innerHTML = "";
        this.list.forEach(inv => {
          const div = document.createElement("div");
          div.textContent = `ÙØ§ØªÙˆØ±Ø© #${inv.id} - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${inv.total} - ${inv.status || "ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©"}`;
          container.appendChild(div);
        });
      },
      async newInvoice() {
        const data = { total: 0, created: new Date().toISOString(), status: "ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø©" };
        const docRef = await db.collection("invoices").add(data);
        this.list.push({ id: docRef.id, ...data });
        this.render();
      }
    };

    // ================== Workers Controller ==================
    const WorkersController = {
      list: [],
      async load() {
        const snapshot = await db.collection("workers").get();
        this.list = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        this.render();
      },
      render() {
        const container = document.getElementById("workerList");
        container.innerHTML = "";
        this.list.forEach(worker => {
          const div = document.createElement("div");
          div.textContent = `Ø§Ù„Ù…ÙˆØ¸Ù: ${worker.name} - Ø§Ù„Ø±Ø§ØªØ¨: ${worker.salary}`;
          container.appendChild(div);
        });
      },
      async newWorker() {
        const name = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:");
        const salary = prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨:");
        if (!name || !salary) return;
        const data = { name, salary, created: new Date().toISOString() };
        const docRef = await db.collection("workers").add(data);
        this.list.push({ id: docRef.id, ...data });
        this.render();
      }
    };

    // ================== Reports Controller ==================
    const ReportsController = {
      async backup() {
        alert("ğŸš€ Ø³ÙŠØªÙ… Ù‡Ù†Ø§ ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
      },
      async restore() {
        alert("ğŸ“¥ Ø³ÙŠØªÙ… Ù‡Ù†Ø§ ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©.");
      },
      async reset() {
        if (confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ")) {
          alert("âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        }
      }
    };

    // ================== Scanner Controller ==================
    const ScannerController = {
      init() {
        const input = document.getElementById("barcodeInput");
        input.addEventListener("change", () => {
          alert("ğŸ“¦ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: " + input.value);
          input.value = "";
        });
      }
    };
    // ================== Offline Manager ==================
    const OfflineManager = {
      queue: [],
      init() {
        window.addEventListener("offline", () => this.updateStatus());
        window.addEventListener("online", () => this.sync());
        this.updateStatus();
      },
      updateStatus() {
        const status = document.getElementById("connectionStatus");
        if (navigator.onLine) {
          status.textContent = "âœ… Ù…ØªØµÙ„";
          status.style.background = "green";
        } else {
          status.textContent = "âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„";
          status.style.background = "red";
        }
      },
      async sync() {
        this.updateStatus();
        if (this.queue.length > 0) {
          alert("ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© " + this.queue.length + " Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹Ù„Ù‚Ø©...");
          // Ù‡Ù†Ø§ ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¥Ù„Ù‰ Firestore
          this.queue = [];
        }
      },
      add(operation) {
        if (navigator.onLine) {
          // ØªÙ†ÙÙŠØ° Ù…Ø¨Ø§Ø´Ø±
          operation();
        } else {
          this.queue.push(operation);
          alert("â³ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø£Ø¶ÙŠÙØª ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„).");
        }
      }
    };

    // ================== App ==================
    const App = {
      async init() {
        OfflineManager.init();
        ScannerController.init();
        await InvoicesController.load();
        await WorkersController.load();
        this.bindEvents();
      },
      bindEvents() {
        document.getElementById("newInvoice").addEventListener("click", () => InvoicesController.newInvoice());
        document.getElementById("newWorker").addEventListener("click", () => WorkersController.newWorker());
        document.getElementById("backupBtn").addEventListener("click", () => ReportsController.backup());
        document.getElementById("restoreBtn").addEventListener("click", () => ReportsController.restore());
        document.getElementById("resetBtn").addEventListener("click", () => ReportsController.reset());
      }
    };

    window.addEventListener("DOMContentLoaded", () => App.init());
  </script>
</head>
<body>
  <h1>ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±</h1>

  <div id="connectionStatus" style="padding:5px;color:white;text-align:center">...</div>

  <section>
    <h2>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h2>
    <button id="newInvoice">â• ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <div id="invoiceList"></div>
  </section>

  <section>
    <h2>Ø§Ù„Ù…ÙˆØ¸ÙÙˆÙ†</h2>
    <button id="newWorker">â• Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</button>
    <div id="workerList"></div>
  </section>

  <section>
    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
    <button id="backupBtn">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
    <button id="restoreBtn">ğŸ“¥ Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
    <button id="resetBtn">âš ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
  </section>

  <section>
    <h2>ğŸ“· Ø§Ù„Ù…Ø§Ø³Ø­ Ø§Ù„Ø¶ÙˆØ¦ÙŠ</h2>
    <input type="text" id="barcodeInput" placeholder="Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù‡Ù†Ø§">
  </section>
</body>
</html>
